drop view if exists v_cupomfiscal_item;

CREATE VIEW v_cupomfiscal_item
AS 
 SELECT 
    1 AS CD_EMP,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.ORIGEM as CD_FILIAL,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.DATA_CAIXA as DT_VD,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.DATA_CAIXA AS DT_CAD,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.HORA_OPERACAO AS HR_VD,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.ID_ESTACAO as CD_CX,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.ID_NOTA AS CD_VD,
    SIG_POS_dbo.POS_NOTAS_TOTAIS.ID_NOTA AS NR_ECF,
    0 AS ST_VD,
    1 AS CD_IT,
    SIG_POS_dbo.POS_NOTAS_DETALHES.P_CODIGO AS CD_PROD,
    0 AS CD_MEDICO_REC,
    '' AS DS_PROD,
    NULL AS CD_BARRA,
    SIG_POS_dbo.POS_NOTAS_DETALHES.QTD AS QT_IT,
    SIG_POS_dbo.POS_NOTAS_DETALHES.VALOR AS VLR_IT,
    (SIG_POS_dbo.POS_NOTAS_DETALHES.QTD * SIG_POS_dbo.POS_NOTAS_DETALHES.VALOR) AS TOT_IT,
    (CASE WHEN SIG_POS_dbo.POS_NOTAS_DETALHES.STATUS='C' THEN
        1
    ELSE
        0
    END) AS ST_IT,
    0 AS TIPO_DESCONTO,
    0 AS TX_DESC,
    0 AS VLR_DESC_VERBA,
    0 AS VLR_DESC_RATEIO,
    0 AS CD_TRIB_FC,
    ((SIG_POS_dbo.POS_NOTAS_DETALHES.VALOR_ICMS * 100)/SIG_POS_dbo.POS_NOTAS_DETALHES.VALOR) AS TX_ICMS_IT,
    0 AS TX_RED_IT,
    0 AS CD_VEND,
    NULL AS NM_VEND,
    0 AS CD_VEND_VERBA,
    '' AS NM_VEND_VERBA,
    0 AS CD_USU_CANCEL,
    NULL AS NM_USU_CANCEL,
    ROUND(SIG_POS_dbo.POS_NOTAS_TOTAIS.CREDITO_OPERACAO,2) AS QT_PONTOS_FIDEL,
    0 AS CD_GRUPO_COMISSAO,
    (CASE WHEN SIG_POS_dbo.POS_NOTAS_DETALHES.STATUS='C' THEN
        1
    ELSE
        0
    END) AS IS_CANCELADO,        
    0 AS CD_LOTE,
    0 AS NUMERO_LOTE,
    0 AS QTDE_PROD_LOTE,
    0 AS REGISTROALTERADOITEM,
    0 AS TIPO_IMPOSTO,
    0 AS VALOR_IBPT_ITEM,
    SIG_POS_dbo.POS_NOTAS_DETALHES.IBPT_NACIONAL AS PERCENTUAL_IBPT_ITEM,
    '' AS NR_PROTOCOLO,
    0 AS FLAG_CONSOLIDADO,
    0 AS PERC_DESC_DIFF
   FROM 
        SIG_POS_dbo.POS_NOTAS_TOTAIS INNER JOIN SIG_POS_dbo.POS_NOTAS_DETALHES ON 
        SIG_POS_dbo.POS_NOTAS_TOTAIS.ID_NOTA = SIG_POS_dbo.POS_NOTAS_DETALHES.ID_NOTA        

